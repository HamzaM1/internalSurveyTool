sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,a,n,i){"use strict";var r=new sap.ui.model.odata.v2.ODataModel("/project/intern-project/intern-project-odata.xsodata/");var s;var u;var d;var c;var l=false;return e.extend("demo.survey2.SurveyDemo2.controller.UserResults",{formatter:a,onInit:function(){d=this;var e=new t({shareOnJamTitle:this.getResourceBundle().getText("questionTitle"),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0});this.setModel(e,"questionView");var o;e=new t({busy:true,delay:0});this.getRouter().getRoute("quizpage").attachPatternMatched(this._onObjectMatched,this);o=this.getView().getBusyIndicatorDelay();this.setModel(e,"objectView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){e.setProperty("/delay",o)})},onUpdateFinished:function(e){if(l===false){this._applySearch(c);l=true}},_applySearch:function(e){var t=this.byId("list"),o=this.getModel("questionView");t.getBinding("items").filter(e,"Application");if(e.length!==0){o.setProperty("/tableNoDataText",this.getResourceBundle().getText("questionNoDataWithSearchText"))}},onPress:function(e){this._showObject(e.getSource())},_showObject:function(e){r.read("/SQ('"+s+"')",{success:function(t){d.getRouter().navTo("answer",{objectId:e.getBindingContext().getProperty("QUESTIONID"),count:t.NUM_OF_QUESTIONS})}})},onNavBack:function(){var e=o.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}else{this.getRouter().navTo("overview",{},true)}},onPressHome:function(e){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("overview")},onPressSubmit:function(e){u=sap.ui.getCore().getModel("userapi").getData().name;r.read("/SQ('"+s+"')",{success:function(e){var t=sap.ui.core.UIComponent.getRouterFor(d);if(e.SQ_TYPE==="Survey"){var o={USQID:u+s,USERID:u,SQID:s,SUBMITTED:1};var a="/UserSQ('"+u+s+"')";r.update(a,o);t.navTo("surveyComplete")}else{o={USQID:u+s,USERID:u,SQID:s,SUBMITTED:1,PASSED:1};a="/UserSQ('"+u+s+"')";r.update(a,o);t.navTo("userResults",{objectId:e.SQID})}}})},_onObjectMatched:function(e){var t=window.location.href;var o=t.split("/");var a=o.length-1;s=o[a];u=sap.ui.getCore().getModel("userapi").getData().name;var i={USQID:u+s,USERID:u,SQID:s,SUBMITTED:0};r.create("/UserSQ",i);c=new n({path:"SQID",operator:"EQ",value1:s});this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("SQ",{SQID:s});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("objectView"),o=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){o.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),o=e.getElementBinding();if(!o.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var a=this.getResourceBundle(),n=e.getBindingContext().getObject(),i=n.SQID,r=n.SQ_TITLE;t.setProperty("/busy",false);t.setProperty("/shareSendEmailSubject",a.getText("shareSendEmailObjectSubject",[i]));t.setProperty("/shareSendEmailMessage",a.getText("shareSendEmailObjectMessage",[r,i,location.href]))}})});