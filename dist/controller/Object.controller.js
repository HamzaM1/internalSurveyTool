sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History","../model/formatter","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,t,o,i,n,a,r){"use strict";var s=new sap.ui.model.odata.v2.ODataModel("/project/intern-project/intern-project-odata.xsodata/");var u;var d;var l;var c;var g=0;var h=false;return e.extend("demo.survey2.SurveyDemo2.controller.Object",{formatter:i,onInit:function(){c=this;u=sap.ui.getCore().getModel("userapi").getData().name;s.read("/Users('"+u+"')",{success:function(e){var t=new sap.ui.model.json.JSONModel({count:e.NUM_OF_SQ});sap.ui.getCore().setModel(t,"count")}});var e=new t({userSQTitle:"",shareOnJamTitle:this.getResourceBundle().getText("questionTitle"),tableNoDataText:this.getResourceBundle().getText("tableNoDataText"),tableBusyDelay:0});this.setModel(e,"questionView");var o,e=new t({busy:true,delay:0});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);o=this.getView().getBusyIndicatorDelay();this.setModel(e,"objectView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){e.setProperty("/delay",o)})},onUpdateFinished:function(e){if(h===false){this._applySearch(l);h=true}},_applySearch:function(e){var t=this.byId("list"),o=this.getModel("questionView");t.getBinding("items").filter(e,"Application");if(e.length!==0){o.setProperty("/tableNoDataText",this.getResourceBundle().getText("questionNoDataWithSearchText"))}},onPress:function(e){this._showObject(e.getSource())},_showObject:function(e){var t=e.getBindingContext().getProperty("QUESTIONID");this.getRouter().navTo("question",{objectId:t})},onNavBack:function(){var e=o.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}else{this.getRouter().navTo("overview",{},true)}},onPressHome:function(e){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("overview")},onPressQuiz:function(e){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("quizEntry",{objectId:d})},onPressCopy:function(e){var t=c.getView();if(g===0){r.load({id:"copyLink",controller:c,type:"XML",name:"demo.survey2.SurveyDemo2.view.Copy"}).then(function(e){t.addDependent(e);g=e;e.open()})}else{g.open()}},onCloseDialog:function(){g.close()},onDelete:function(e){s.remove(this.getModel().createKey("/SQ",{SQID:d}));var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("overview")},_onObjectMatched:function(e){d=e.getParameter("arguments").objectId;l=new n({path:"SQID",operator:"EQ",value1:d});this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("SQ",{SQID:d});this._bindView("/"+e)}.bind(this));var t=this.byId("list"),o=this.getModel("questionView");t.getBinding("items").filter(l,"Application")},_bindView:function(e){var t=this.getModel("objectView"),o=this.getModel();this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(){o.metadataLoaded().then(function(){t.setProperty("/busy",true)})},dataReceived:function(){t.setProperty("/busy",false)}}})},onFilter:function(e){var t=this.byId("list1");var o=t.getItems();s.read("/SQ('"+d+"')",{success:function(e){for(var t in o){if(e.ANONYMOUS===1){o[t].setTitle("Anonymous User")}var i=o[t].getNumber();if(i==="1"){o[t].setNumber("Quiz Passed")}else if(i==="0"){o[t].setNumber("Quiz Failed")}else if(i==="-1"){o[t].setNumber("")}}}});var i=e.getParameter("total");this.getModel("questionView").setProperty("/userSQTitle",i);var a=[];a.push(new n({path:"SQID",operator:"EQ",value1:d}));a.push(new n({path:"SUBMITTED",operator:"EQ",value1:1}));t.getBinding("items").filter(a,"Application")},_onBindingChange:function(){var e=this.getView(),t=this.getModel("objectView"),o=e.getElementBinding();if(!o.getBoundContext()){this.getRouter().getTargets().display("objectNotFound");return}var i=this.getResourceBundle(),n=e.getBindingContext().getObject(),a=n.SQID,r=n.SQ_TITLE;t.setProperty("/busy",false);t.setProperty("/shareSendEmailSubject",i.getText("shareSendEmailObjectSubject",[a]));t.setProperty("/shareSendEmailMessage",i.getText("shareSendEmailObjectMessage",[r,a,location.href]))}})});