sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History"],function(e,t,n){"use strict";var a;var s=new sap.ui.model.odata.v2.ODataModel("/project/intern-project/intern-project-odata.xsodata/");var o;var r;var i;var u;var d;var v;var I;var l;return e.extend("demo.survey2.SurveyDemo2.controller.SurveyQuestion",{onInit:function(){l=this;o={answer0:"Yes",answer1:"No",answer2:"Maybe",answer3:"",answer4:""};a=new t(o);this.getView().setModel(a);var e=new sap.ui.model.json.JSONModel({answersCount:r});sap.ui.getCore().setModel(e,"answersCount");this.getRouter().getRoute("surveyQuestion").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){i=e.getParameter("arguments").type;u=e.getParameter("arguments").count;var t=sap.ui.getCore().getModel("qcount").getData().qcount;d=e.getParameter("arguments").sq;if(i==="Radio"||i==="Check"){r=2}else{r=1}v=sap.ui.getCore().getModel("currentsq").getData().currentsq;if(u.toString()===t.toString()){var n={SQID:v,NUM_OF_QUESTIONS:parseInt(u,10)+1};s.update("/SQ('"+v+"')",n);t++;var a=new sap.ui.model.json.JSONModel({qcount:t});sap.ui.getCore().setModel(a,"qcount");var o={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:"",ANSWER_TYPE:i,NUM_OF_ANSWERS:r};s.create("/Questions",o)}this.createAnswers()},onNavBack:function(){l.byId("vbox").destroyItems();var e=n.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}else{this.getRouter().navTo("overview",{},true)}},onPressHome:function(e){l.byId("vbox").destroyItems();var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("overview")},getQuestion:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=this.getView().getModel().getProperty("/InputValue");var n=e.getText("question",[t])},onOpenQDialog:function(){this.getOwnerComponent().openSaveQDialog()},handleLiveChange:function(e){I=e.getParameter("value");var t={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:I,ANSWER_TYPE:i,NUM_OF_ANSWERS:r};s.update("/Questions('"+v+u+"')",t)},createAnswers:function(){var e=true;if(d==="Survey"){e=false}var t;var n;var a;if(d==="Quiz"){n=0;a=1}if(i==="Slide"){var r=new sap.m.Slider({id:v+u+"0",enabled:e,enableTickmarks:true,value:5,width:"60%",min:0,max:10,showAdvancedTooltip:true,showHandleTooltip:false,inputsAsTooltips:true,change:function(e){l.onSlide(e)}});this.getView().byId("vbox").addItem(r);t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:"0",ANSWER_CORRECT:n,ORDER:1};s.create("/Answers",t)}else if(i==="Text"){var I=new sap.m.Input({id:v+u+"0",enabled:e,width:"50%",value:"{/answer0}",liveChange:function(e){l.onType(e)}});this.getView().byId("vbox").addItem(I);t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:o.answer0,ANSWER_CORRECT:n,ORDER:1};s.create("/Answers",t)}else if(i==="Radio"||i==="Check"){var c;var S=new sap.m.List({id:"list",width:"50%",backgroundDesign:"Transparent"});var w=new sap.m.InputListItem({id:"inputlist0"});var p=new sap.m.Input({id:v+u+"0t",value:"{/answer0}",valueLiveUpdate:true,liveChange:function(e){l.onType2(e)}});w.addContent(p);var R=new sap.m.InputListItem({id:"inputlist1"});var g=new sap.m.Input({id:v+u+"1t",value:"{/answer1}",valueLiveUpdate:true,liveChange:function(e){l.onType2(e)}});R.addContent(g);S.addItem(w);S.addItem(R);var E=new sap.m.Button({id:"button0",icon:"sap-icon://add",press:function(){l.onAdd()}});var m=new sap.m.Button({id:"button1",icon:"sap-icon://less",press:function(){l.onRemove()}});if(i==="Radio"){var N=new sap.m.RadioButtonGroup({id:"radio",enabled:e});var T=new sap.m.RadioButton({id:v+u+"0",text:"{/answer0}",select:function(e){l.onSelect(e)}});var f=new sap.m.RadioButton({id:v+u+"1",text:"{/answer1}",select:function(e){l.onSelect(e)}});N.addButton(T);N.addButton(f);c=new sap.ui.layout.form.SimpleForm({editable:true,content:[N]});t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:o.answer0,ANSWER_CORRECT:a,ORDER:1};s.create("/Answers",t);t={ANSWERID:v+u+"1",QUESTIONID:v+u,ANSWER:o.answer1,ANSWER_CORRECT:n,ORDER:2};s.create("/Answers",t)}else{var C=new sap.m.VBox({id:"check"});var A=new sap.m.CheckBox({id:v+u+"0",enabled:e,text:"{/answer0}",select:function(e){l.onSelect(e)}});var O=new sap.m.CheckBox({id:v+u+"1",enabled:e,text:"{/answer1}",select:function(e){l.onSelect(e)}});C.addItem(A);C.addItem(O);c=new sap.ui.layout.form.SimpleForm({editable:true,content:[C]});t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:o.answer0,ANSWER_CORRECT:n,ORDER:1};s.create("/Answers",t);t={ANSWERID:v+u+"1",QUESTIONID:v+u,ANSWER:o.answer1,ANSWER_CORRECT:n,ORDER:2};s.create("/Answers",t)}c.addContent(S);this.getView().byId("vbox").addItem(c);this.getView().byId("vbox").addItem(E);this.getView().byId("vbox").addItem(m)}},onRemove:function(){if(r>2){r-=1;if(i==="Radio"){this.getView().byId("vbox").getItems()[0].getContent()[0].getButtons()[r].destroy()}else{this.getView().byId("vbox").getItems()[0].getContent()[0].getItems()[r].destroy()}this.getView().byId("vbox").getItems()[0].getContent()[1].getItems()[r].destroy();var e=new sap.ui.model.json.JSONModel({answersCount:r});sap.ui.getCore().setModel(e,"answersCount");var t={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:I,ANSWER_TYPE:i,NUM_OF_ANSWERS:r};s.update("/Questions('"+v+u+"')",t);s.remove("/Answers('"+v+u+r+"')")}},onAdd:function(){var e=true;if(d==="Survey"){e=false}var t;if(r===2){t=o.answer2}else if(r===3){t=o.answer3}else if(r===4){t=o.answer4}var n;if(d==="Quiz"){n=0}if(r<5){if(i==="Radio"){var a=new sap.m.RadioButton({id:v+u+r,text:"{/answer"+r+"}",select:function(e){l.onSelect(e)}});this.getView().byId("vbox").getItems()[0].getContent()[0].addButton(a)}else{var c=new sap.m.CheckBox({id:v+u+r,enabled:e,text:"{/answer"+r+"}",select:function(e){l.onSelect(e)}});this.getView().byId("vbox").getItems()[0].getContent()[0].addItem(c)}var S={ANSWERID:v+u+r,QUESTIONID:v+u,ANSWER:t,ANSWER_CORRECT:n,ORDER:r+1};s.create("/Answers",S);var w=new sap.m.InputListItem({id:"inputlist"+r});var p=new sap.m.Input({id:v+u+r+"t",value:"{/answer"+r+"}",valueLiveUpdate:true,liveChange:function(e){l.onType2(e)}});w.addContent(p);this.getView().byId("vbox").getItems()[0].getContent()[1].addItem(w);r++;var R=new sap.ui.model.json.JSONModel({answersCount:r});sap.ui.getCore().setModel(R,"answersCount");var g={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:I,ANSWER_TYPE:i,NUM_OF_ANSWERS:r};s.update("/Questions('"+v+u+"')",g)}},onSelect:function(e){var t=e.getSource();var n=t.getId();var o="/Answers('"+n+"')";a.read(o,{success:function(e){var n;if(e.CORRECT!==1){n={ANSWER:t.getText(),ANSWER_CORRECT:1}}else{n={ANSWER:t.getText(),ANSWER_CORRECT:0}}s.update(o,n)}})},onSlide:function(e){var t=e.getSource();var n=t.getId();var s="/UserAnswers('"+n+"')";var o={ANSWER:t.getValue().toString()};a.update(s,o)},onType:function(e){var t=e.getSource();var n=t.getId();var s="/UserAnswers('"+n+"')";var o={ANSWER:t.getValue()};a.update(s,o)},onType2:function(e){var t=e.getSource();var n=t.getId().slice(0,-1);var a="/Answers('"+n+"')";var o={ANSWER:t.getValue()};s.update(a,o)}})});