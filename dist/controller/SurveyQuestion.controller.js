sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/core/routing/History"],function(e,t,n){"use strict";var a;var o=new sap.ui.model.odata.v2.ODataModel("/project/intern-project/intern-project-odata.xsodata/");var s;var r;var i;var u;var d;var v;var I;var S;return e.extend("demo.survey2.SurveyDemo2.controller.SurveyQuestion",{onInit:function(){S=this;s={answer0:"Yes",answer1:"No",answer2:"Maybe",answer3:"",answer4:""};a=new t(s);this.getView().setModel(a);var e=new sap.ui.model.json.JSONModel({answersCount:r});sap.ui.getCore().setModel(e,"answersCount");this.getRouter().getRoute("surveyQuestion").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(e){i=e.getParameter("arguments").type;u=e.getParameter("arguments").count;var t=sap.ui.getCore().getModel("qcount").getData().qcount;d=e.getParameter("arguments").sq;if(i==="Radio"||i==="Check"){r=2}else{r=1}v=sap.ui.getCore().getModel("currentsq").getData().currentsq;if(u.toString()===t.toString()){var n={SQID:v,NUM_OF_QUESTIONS:parseInt(u,10)+1};o.update("/SQ('"+v+"')",n);t++;var a=new sap.ui.model.json.JSONModel({qcount:t});sap.ui.getCore().setModel(a,"qcount");var s={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:"",ANSWER_TYPE:i,NUM_OF_ANSWERS:r};o.create("/Questions",s)}this.createAnswers()},onNavBack:function(){S.byId("vbox").destroyItems();var e=n.getInstance().getPreviousHash();if(e!==undefined){history.go(-1)}else{this.getRouter().navTo("overview",{},true)}},onPressHome:function(e){S.byId("vbox").destroyItems();var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("overview")},getQuestion:function(){var e=this.getView().getModel("i18n").getResourceBundle();var t=this.getView().getModel().getProperty("/InputValue");var n=e.getText("question",[t])},onOpenQDialog:function(){this.getOwnerComponent().openSaveQDialog()},handleLiveChange:function(e){I=e.getParameter("value");var t={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:I,ANSWER_TYPE:i,NUM_OF_ANSWERS:r};o.update("/Questions('"+v+u+"')",t)},createAnswers:function(){var e=true;if(d==="Survey"){e=false}var t;var n=-1;var a=-1;if(d==="Quiz"){n=0;a=1}if(i==="Slide"){var r=new sap.m.Slider({id:v+u+"0",enabled:e,enableTickmarks:true,value:5,width:"60%",min:0,max:10,showAdvancedTooltip:true,showHandleTooltip:false,inputsAsTooltips:true,change:function(e){S.onSlide(e)}});this.getView().byId("vbox").addItem(r);t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:"0",ANSWER_CORRECT:1,ORDER:1};o.create("/Answers",t)}else if(i==="Text"){var I=new sap.m.Input({id:v+u+"0",enabled:e,width:"50%",value:"{/answer0}",liveChange:function(e){S.onType(e)}});this.getView().byId("vbox").addItem(I);if(d==="Survey"){t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:"",ANSWER_CORRECT:-1,ORDER:1};o.create("/Answers",t)}else{t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:s.answer0,ANSWER_CORRECT:1,ORDER:1};o.create("/Answers",t)}}else if(i==="Radio"||i==="Check"){var l;var c=new sap.m.List({id:"list",width:"50%",backgroundDesign:"Transparent"});var R=new sap.m.InputListItem({id:"inputlist0"});var w=new sap.m.Input({id:v+u+"0t",value:"{/answer0}",valueLiveUpdate:true,liveChange:function(e){S.onType2(e)}});R.addContent(w);var p=new sap.m.InputListItem({id:"inputlist1"});var E=new sap.m.Input({id:v+u+"1t",value:"{/answer1}",valueLiveUpdate:true,liveChange:function(e){S.onType2(e)}});p.addContent(E);c.addItem(R);c.addItem(p);var g=new sap.m.Button({id:"button0",icon:"sap-icon://add",tooltip:"Add Answer",press:function(){S.onAdd()}});var m=new sap.m.Button({id:"button1",icon:"sap-icon://less",tooltip:"Remove Answer",press:function(){S.onRemove()}});if(i==="Radio"){var N=new sap.m.RadioButtonGroup({id:"radio",enabled:e});var A=new sap.m.RadioButton({id:v+u+"0",text:"{/answer0}",select:function(e){S.onSelect(e)}});var T=new sap.m.RadioButton({id:v+u+"1",text:"{/answer1}",select:function(e){S.onSelect(e)}});N.addButton(A);N.addButton(T);l=new sap.ui.layout.form.SimpleForm({editable:true,content:[N]});t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:s.answer0,ANSWER_CORRECT:a,ORDER:1};o.create("/Answers",t);t={ANSWERID:v+u+"1",QUESTIONID:v+u,ANSWER:s.answer1,ANSWER_CORRECT:n,ORDER:2};o.create("/Answers",t)}else{var C=new sap.m.VBox({id:"check"});var f=new sap.m.CheckBox({id:v+u+"0",enabled:e,text:"{/answer0}",select:function(e){S.onSelect(e)}});var O=new sap.m.CheckBox({id:v+u+"1",enabled:e,text:"{/answer1}",select:function(e){S.onSelect(e)}});C.addItem(f);C.addItem(O);l=new sap.ui.layout.form.SimpleForm({editable:true,content:[C]});t={ANSWERID:v+u+"0",QUESTIONID:v+u,ANSWER:s.answer0,ANSWER_CORRECT:n,ORDER:1};o.create("/Answers",t);t={ANSWERID:v+u+"1",QUESTIONID:v+u,ANSWER:s.answer1,ANSWER_CORRECT:n,ORDER:2};o.create("/Answers",t)}l.addContent(c);this.getView().byId("vbox").addItem(l);this.getView().byId("vbox").addItem(g);this.getView().byId("vbox").addItem(m)}},onRemove:function(){if(r>2){r-=1;if(i==="Radio"){this.getView().byId("vbox").getItems()[0].getContent()[0].getButtons()[r].destroy()}else{this.getView().byId("vbox").getItems()[0].getContent()[0].getItems()[r].destroy()}this.getView().byId("vbox").getItems()[0].getContent()[1].getItems()[r].destroy();var e=new sap.ui.model.json.JSONModel({answersCount:r});sap.ui.getCore().setModel(e,"answersCount");var t={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:I,ANSWER_TYPE:i,NUM_OF_ANSWERS:r};o.update("/Questions('"+v+u+"')",t);o.remove("/Answers('"+v+u+r+"')")}},onAdd:function(){var e=true;if(d==="Survey"){e=false}var t;if(r===2){t=s.answer2}else if(r===3){t=s.answer3}else if(r===4){t=s.answer4}var n=-1;if(d==="Quiz"){n=0}if(r<5){if(i==="Radio"){var a=new sap.m.RadioButton({id:v+u+r,text:"{/answer"+r+"}",select:function(e){S.onSelect(e)}});this.getView().byId("vbox").getItems()[0].getContent()[0].addButton(a)}else{var l=new sap.m.CheckBox({id:v+u+r,enabled:e,text:"{/answer"+r+"}",select:function(e){S.onSelect(e)}});this.getView().byId("vbox").getItems()[0].getContent()[0].addItem(l)}var c={ANSWERID:v+u+r,QUESTIONID:v+u,ANSWER:t,ANSWER_CORRECT:n,ORDER:r+1};o.create("/Answers",c);var R=new sap.m.InputListItem({id:"inputlist"+r});var w=new sap.m.Input({id:v+u+r+"t",value:"{/answer"+r+"}",valueLiveUpdate:true,liveChange:function(e){S.onType2(e)}});R.addContent(w);this.getView().byId("vbox").getItems()[0].getContent()[1].addItem(R);r++;var p=new sap.ui.model.json.JSONModel({answersCount:r});sap.ui.getCore().setModel(p,"answersCount");var E={QUESTIONID:v+u,SQID:v,QUESTION_TITLE:"Question "+(parseInt(u,10)+1),QUESTION:I,ANSWER_TYPE:i,NUM_OF_ANSWERS:r};o.update("/Questions('"+v+u+"')",E)}},onSelect:function(e){var t=e.getSource();var n=t.getId();var a="/Answers('"+n+"')";o.read(a,{success:function(e){var n;if(e.ANSWER_CORRECT!==1){n={ANSWER:t.getText(),ANSWER_CORRECT:1}}else{n={ANSWER:t.getText(),ANSWER_CORRECT:0}}o.update(a,n)}})},onSlide:function(e){var t=e.getSource();var n=t.getId();var a="/Answers('"+n+"')";var s={ANSWER:t.getValue().toString()};o.update(a,s)},onType:function(e){var t=e.getSource();var n=t.getId();var a="/Answers('"+n+"')";var s={ANSWER:t.getValue()};o.update(a,s)},onType2:function(e){var t=e.getSource();var n=t.getId().slice(0,-1);var a="/Answers('"+n+"')";var s={ANSWER:t.getValue()};o.update(a,s)}})});